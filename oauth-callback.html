<!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!doctype html>

<html lang="en">

<head><html lang="en">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="en">

    <title>Auth Callback - Whiteout Survival Bot</title>

    <style>    <meta charset="UTF-8">

        body {

            font-family: "Segoe UI", Arial, sans-serif;    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="en">

            background: #0E0E10;

            color: #fff;    <title>Auth Callback - Whiteout Survival Bot</title>

            margin: 0;

            padding: 0;    <style>    <meta charset="UTF-8">

            min-height: 100vh;

            display: flex;        body {

            align-items: center;

            justify-content: center;            font-family: "Segoe UI", Arial, sans-serif;    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="en"><html lang="en">

            text-align: center;

        }            background: #0E0E10;

        .container {

            background: #18151c;            color: #fff;    <title>Auth Callback - Whiteout Survival Bot</title>

            padding: 20px;

            border-radius: 8px;            margin: 0;

            margin: 20px;

            max-width: 500px;            padding: 0;    <style>    <meta charset="UTF-8">

            width: 100%;

        }            min-height: 100vh;

        .spinner {

            border: 4px solid rgba(255, 255, 255, 0.1);            display: flex;        body {

            border-radius: 50%;

            border-top: 4px solid #5865F2;            align-items: center;

            width: 40px;

            height: 40px;            justify-content: center;            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><head>

            animation: spin 1s linear infinite;

            margin: 20px auto;            text-align: center;

        }

        @keyframes spin {        }            background: #0E0E10;

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }        .container {

        }

        .error-link {            background: #18151c;            color: #fff;    <title>Auth Callback - Whiteout Survival Bot</title>

            color: #5865F2;

            text-decoration: none;            padding: 20px;

            margin-top: 20px;

            display: inline-block;            border-radius: 8px;            margin: 0;

        }

        .error-link:hover {            margin: 20px;

            text-decoration: underline;

        }            max-width: 500px;            padding: 0;    <style>    <meta charset="UTF-8">  <meta charset="utf-8">

    </style>

</head>            width: 100%;

<body>

    <div class="container" id="content">        }            height: 100vh;

        <div class="spinner"></div>

        <h2>Authenticating...</h2>        .spinner {

        <p>Please wait while we complete your sign in.</p>

    </div>            border: 4px solid rgba(255, 255, 255, 0.1);            display: flex;        body {

    <script>

        async function handleCallback() {            border-radius: 50%;

            const content = document.getElementById('content');

            try {            border-top: 4px solid #5865F2;            align-items: center;

                const urlParams = new URLSearchParams(window.location.search);

                const code = urlParams.get('code');            width: 40px;

                if (!code) {

                    content.innerHTML = `            height: 40px;            justify-content: center;            font-family: "Segoe UI", Arial, sans-serif;    <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta name="viewport" content="width=device-width,initial-scale=1">

                        <h2>Authentication Error</h2>

                        <p>No authorization code received. Please try again.</p>            animation: spin 1s linear infinite;

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>

                    `;            margin: 20px auto;            text-align: center;

                    return;

                }        }

                // Exchange the code for tokens through your backend

                const response = await fetch('https://whiteout-survival-bot.onrender.com/auth/callback', {        @keyframes spin {        }            background: #0E0E10;

                    method: 'POST',

                    headers: {            0% { transform: rotate(0deg); }

                        'Content-Type': 'application/json'

                    },            100% { transform: rotate(360deg); }        .container {

                    body: JSON.stringify({ code })

                });        }

                if (!response.ok) {

                    content.innerHTML = `        .error-link {            background: #18181b;            color: #fff;    <title>Auth Callback - Whiteout Survival Bot</title>  <title>OAuth Callback — Whiteout Bot Dashboard</title>

                        <h2>OAuth Error</h2>

                        <p>Failed to exchange code for token.</p>            color: #5865F2;

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>

                    `;            text-decoration: none;            padding: 2rem;

                    return;

                }            margin-top: 20px;

                const data = await response.json();

                if (!data.access_token) {            display: inline-block;            border-radius: 8px;            margin: 0;

                    content.innerHTML = `

                        <h2>Authentication Error</h2>        }

                        <p>No access token received. Check your backend implementation.</p>

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>        .error-link:hover {            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

                    `;

                    return;            text-decoration: underline;

                }

                localStorage.setItem('discord_token', data.access_token);        }            max-width: 90%;            padding: 20px;    <style>  <style>

                window.location.href = '/dashboard.html';

            } catch (error) {    </style>

                content.innerHTML = `

                    <h2>Authentication Error</h2></head>            width: 400px;

                    <p>${error.message || 'There was a problem signing you in. Please try again.'}</p>

                    <a href="/dashboard.html" class="error-link">Return to Dashboard</a><body>

                `;

            }    <div class="container" id="content">        }            min-height: 100vh;

        }

        handleCallback();        <div class="spinner"></div>

    </script>

</body>        <h2>Authenticating...</h2>        h1 {

</html>
        <p>Please wait while we complete your sign in.</p>

    </div>            margin: 0 0 1rem;            display: flex;        body {    body{ font-family: "Segoe UI", Arial, sans-serif; background:linear-gradient(135deg,#071021,#0b1220); color:#e6f7ff; display:flex; align-items:center; justify-content:center; height:100vh; margin:0 }

    <script>

        async function handleCallback() {            color: #fff;

            const content = document.getElementById('content');

            try {        }            flex-direction: column;

                const urlParams = new URLSearchParams(window.location.search);

                const code = urlParams.get('code');        p {

                if (!code) {

                    content.innerHTML = `            margin: 1rem 0;            align-items: center;            font-family: "Segoe UI", Arial, sans-serif;    .box{ background:#07121a; padding:20px; border-radius:10px; width:640px; box-shadow:0 10px 30px rgba(0,0,0,0.5) }

                        <h2>Authentication Error</h2>

                        <p>No authorization code received. Please try again.</p>            color: #a8a8b3;

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>

                    `;        }            justify-content: center;

                    return;

                }        .loader {

                // Exchange the code for tokens through your backend

                const response = await fetch('https://whiteout-survival-bot.onrender.com/auth/callback', {            border: 3px solid #18181b;            text-align: center;            background: #0E0E10;    pre{ background:#06121a; padding:12px; border-radius:8px; overflow:auto }

                    method: 'POST',

                    headers: {            border-radius: 50%;

                        'Content-Type': 'application/json'

                    },            border-top: 3px solid #5865f2;        }

                    body: JSON.stringify({ code })

                });            width: 24px;

                if (!response.ok) {

                    content.innerHTML = `            height: 24px;        .message {            color: #fff;    a{ color:#7fe0ff }

                        <h2>OAuth Error</h2>

                        <p>Failed to exchange code for token.</p>            animation: spin 1s linear infinite;

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>

                    `;            margin: 1rem auto;            background: #18151c;

                    return;

                }        }

                const data = await response.json();

                if (!data.access_token) {        @keyframes spin {            padding: 20px;            margin: 0;  </style>

                    content.innerHTML = `

                        <h2>Authentication Error</h2>            0% { transform: rotate(0deg); }

                        <p>No access token received. Check your backend implementation.</p>

                        <a href="/dashboard.html" class="error-link">Return to Dashboard</a>            100% { transform: rotate(360deg); }            border-radius: 8px;

                    `;

                    return;        }

                }

                localStorage.setItem('discord_token', data.access_token);    </style>            margin: 20px;            padding: 20px;</head>

                window.location.href = '/dashboard.html';

            } catch (error) {</head>

                content.innerHTML = `

                    <h2>Authentication Error</h2><body>            max-width: 500px;

                    <p>${error.message || 'There was a problem signing you in. Please try again.'}</p>

                    <a href="/dashboard.html" class="error-link">Return to Dashboard</a>    <div class="container">

                `;

            }        <div class="loader"></div>        }            min-height: 100vh;<body>

        }

        handleCallback();        <h1>Authenticating...</h1>

    </script>

</body>        <p>Please wait while we complete your sign in</p>        .spinner {

</html>
    </div>

            border: 4px solid rgba(255, 255, 255, 0.1);            display: flex;  <div class="box">

    <script>

        (async function() {            border-radius: 50%;

            try {

                const code = new URLSearchParams(window.location.search).get('code');            border-top: 4px solid #5865F2;            flex-direction: column;    <h2>OAuth callback</h2>

                

                if (!code) {            width: 40px;

                    throw new Error('No authorization code received');

                }            height: 40px;            align-items: center;    <p>This page captures the OAuth redirect from Discord.</p>



                const response = await fetch('https://whiteout-survival-bot.onrender.com/auth/callback', {            animation: spin 1s linear infinite;

                    method: 'POST',

                    headers: {            margin: 20px auto;            justify-content: center;    <div id="content">

                        'Content-Type': 'application/json'

                    },        }

                    body: JSON.stringify({ code })

                });        @keyframes spin {            text-align: center;      <p>Parsing response...</p>



                if (!response.ok) {            0% { transform: rotate(0deg); }

                    throw new Error('Authentication failed');

                }            100% { transform: rotate(360deg); }        }    </div>



                const data = await response.json();        }

                localStorage.setItem('discord_token', data.access_token);

                window.location.href = '/dashboard.html';        .error-link {        .message {    <p class="muted">After successful login you'll be redirected back to the dashboard. For production, exchange the returned code server-side (Authorization Code flow).</p>

            } catch (error) {

                console.error('Auth error:', error);            color: #5865F2;

                document.querySelector('.container').innerHTML = `

                    <h1>Authentication Error</h1>            text-decoration: none;            background: #18151c;  <p><a href="dashboard.html">Back to dashboard</a> · <a href="login.html">Back to login</a></p>

                    <p>${error.message}</p>

                    <p><a href="/dashboard.html" style="color: #5865f2; text-decoration: none;">Return to Dashboard</a></p>            margin-top: 20px;

                `;

            }            display: inline-block;            padding: 20px;  </div>

        })();

    </script>        }

</body>

</html>        .error-link:hover {            border-radius: 8px;

            text-decoration: underline;

        }            margin: 20px;  <script>

    </style>

</head>            max-width: 500px;    // This page handles both response_type=token (implicit) and response_type=code (auth code)

<body>

    <div class="message">        }    function parseQuery(qs){

        <div class="spinner"></div>

        <h2>Processing Authentication...</h2>        .spinner {      const params = new URLSearchParams(qs.replace(/^\?/,''));

        <p>Please wait while we complete your sign in.</p>

    </div>            border: 4px solid rgba(255, 255, 255, 0.1);      const out = {};



    <script>            border-radius: 50%;      for(const [k,v] of params.entries()) out[k]=v;

        const CONFIG = {

            API_BASE: 'https://whiteout-survival-bot.onrender.com',            border-top: 4px solid #5865F2;      return out;

            BOT_CLIENT_ID: '1399025185046134866'

        };            width: 40px;    }



        async function handleCallback() {            height: 40px;

            try {

                // Get the authorization code from URL            animation: spin 1s linear infinite;    function parseFragment(hash){

                const urlParams = new URLSearchParams(window.location.search);

                const code = urlParams.get('code');            margin: 20px auto;      const fragment = hash.replace(/^#/, '');



                if (!code) {        }      return parseQuery(fragment);

                    throw new Error('No authorization code received');

                }        @keyframes spin {    }



                // Exchange the code for tokens through your backend            0% { transform: rotate(0deg); }

                const response = await fetch(`${CONFIG.API_BASE}/auth/callback`, {

                    method: 'POST',            100% { transform: rotate(360deg); }    (function(){

                    headers: {

                        'Content-Type': 'application/json'        }      const content = document.getElementById('content');

                    },

                    body: JSON.stringify({ code })    </style>      const q = parseQuery(location.search);

                });

</head>      const f = parseFragment(location.hash);

                if (!response.ok) {

                    const errorData = await response.json();<body>

                    throw new Error(errorData.message || 'Failed to exchange code for token');

                }    <div class="message">      // Prefer fragment (implicit token) if present



                const data = await response.json();        <div class="spinner"></div>      if(Object.keys(f).length){

                

                // Store the access token        <h2>Processing Authentication...</h2>        // implicit: access_token, token_type, expires_in, scope

                localStorage.setItem('discord_token', data.access_token);

                        <p>Please wait while we complete your sign in.</p>        content.innerHTML = '<h3>Received token (client-side flow)</h3>' +

                // Redirect back to dashboard

                window.location.href = '/dashboard.html';    </div>          '<p><strong>Note:</strong> This token arrived in your browser URL fragment. This flow is insecure for production.</p>' +

            } catch (error) {

                console.error('Auth error:', error);          '<pre>'+JSON.stringify(f,null,2)+'</pre>' +

                document.querySelector('.message').innerHTML = `

                    <h2>Authentication Error</h2>    <script>          '<p>Saving token to <code>localStorage</code> as <code>discord_access_token</code> and returning to the dashboard.</p>';

                    <p>${error.message || 'There was a problem signing you in. Please try again.'}</p>

                    <a href="/dashboard.html" class="error-link">Return to Dashboard</a>        const CONFIG = {        try{ localStorage.setItem('discord_access_token', f.access_token || ''); localStorage.setItem('discord_token_scope', f.scope || ''); }

                `;

            }            API_BASE: 'https://whiteout-survival-bot.onrender.com',        catch(e){ console.warn('localStorage failed', e); }

        }

            BOT_CLIENT_ID: '1399025185046134866'        // Redirect to the dashboard where the token will be used to fetch profile and guilds

        // Start the auth process when page loads

        handleCallback();        };        setTimeout(()=> window.location.href = 'dashboard.html', 1200);

    </script>

</body>        return;

</html>
        async function handleCallback() {      }

            try {

                // Get the authorization code from URL      // If we have a code (Authorization Code flow), show it and advise server-side exchange

                const urlParams = new URLSearchParams(window.location.search);      if(q.code){

                const code = urlParams.get('code');        content.innerHTML = '<h3>Received authorization code</h3>' +

          '<p>Copy this code and send it to your backend to exchange for an access token (server must supply client_secret).</p>' +

                if (!code) {          '<pre>'+JSON.stringify(q,null,2)+'</pre>' +

                    throw new Error('No authorization code received');          '<p class="muted">For convenience this demo stores the code in localStorage as <code>discord_auth_code</code> (development only).</p>';

                }  try{ localStorage.setItem('discord_auth_code', q.code); }

  catch(e){}

                // Exchange the code for tokens through your backend  // For authorization code flow we store the code (development convenience)

                const response = await fetch(`${CONFIG.API_BASE}/auth/callback`, {  // and redirect the user to the dashboard where the frontend can ask

                    method: 'POST',  // the backend to exchange the code for tokens.

                    headers: {  setTimeout(()=> window.location.href = 'dashboard.html', 800);

                        'Content-Type': 'application/json'  return;

                    },      }

                    body: JSON.stringify({ code })

                });      // If Discord returned an error

      if(q.error || f.error){

                if (!response.ok) {        const err = q.error || f.error;

                    throw new Error('Failed to exchange code for token');        content.innerHTML = '<h3>OAuth Error</h3><pre>'+JSON.stringify(q || f,null,2)+'</pre>';

                }        return;

      }

                const data = await response.json();

                      content.innerHTML = '<p>No code or token found in the redirect. Check that your Discord application Redirect URI matches this page URL exactly.</p>';

                // Store the access token    })();

                localStorage.setItem('discord_token', data.access_token);  </script>

                </body>

                // Redirect back to dashboard</html>

                window.location.href = '/dashboard.html';
            } catch (error) {
                console.error('Auth error:', error);
                document.querySelector('.message').innerHTML = `
                    <h2>Authentication Error</h2>
                    <p>There was a problem signing you in. Please try again.</p>
                    <a href="/dashboard.html" style="color: #5865F2;">Return to Dashboard</a>
                `;
            }
        }

        // Start the auth process when page loads
        handleCallback();
    </script>
</body>
</html>